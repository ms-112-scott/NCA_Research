# E4 實驗筆記

本文件依據核心研究脈絡，重新組織與說明 E4 系列中各個 Jupyter Notebook 的實驗目的。

**核心研究脈絡**:

1.  **資料處理**: 使用 OpenFOAM 模擬結果作為初始資料集 (Ground Truth)。
2.  **初步模型**: 將 Growing NCA (GNCA) 思想應用於 CFD 資料，建立基準模型 (CFD-GNCA)。
3.  **核心模型**: 引入物理資訊神經網路 (PINN) 的思想，為 NCA 加入物理定律約束，開發 CFD-PI-NCA。
4.  **備用路徑**: 由於原始 CFD 資料集存在問題，轉向 UrbanTales 資料集進行模型驗證。
5.  **平行研究**: 探索非神經網路的傳統流體模擬方法 (LBM) 作為對照。

---

## 第一部分：核心研究路徑 (CFD-PI-NCA)

### `E4-1.0_Data_Visualization.ipynb`

- **簡述**: 實驗的起點，用於視覺化檢查 OpenFOAM 的模擬結果。
- **條列重點**:
  - 讀取 `dynamic_fields.npy` 和 `static_fields.npy`。
  - 繪製速度、壓力等不同物理通道的 2D 切片。
  - 確認資料的維度、數值範圍和物理結構是否符合預期。
- **深入細節**: 此步驟是確保資料品質的第一道防線。透過視覺化，可以直觀地判斷 CFD 模擬結果是否正確，例如流體是否正確地圍繞障礙物，或者邊界條件是否如預期般生效。
- **改進建議**:
  - **互動式介面**: 使用 `ipywidgets` 建立滑桿，動態瀏覽不同時間步和空間切片。
  - **計算物理量**: 增加渦度 (vorticity) 等衍生物理量的計算與視覺化。

### `E4-1.1_Data_Preprocessing.ipynb`

- **簡述**: 將原始的 CFD 資料轉換為神經網路訓練所需的格式。
- **條列重點**:
  - 資料正規化 (Normalization)。
  - 通道選擇與重組。
  - 將資料從 `.npy` 格式轉換為 TensorFlow/PyTorch 的 Tensor 格式。
- **深入細節**: 這是連接 CFD 資料和 AI 模型的橋樑。適當的預處理（特別是正規化）對模型的收斂速度和最終性能至關重要。
- **改進建議**:
  - **流程封裝**: 將整個預處理流程封裝成一個可重複使用的 Python 類別或函式庫。
  - **方法比較**: 系統性地比較不同正規化方法（如 Z-score, Min-Max）對訓練結果的影響。

### `E4-2.0_CFD_GrowthNCA.ipynb`

- **簡述**: 受到 GNCA 的啟發，首次嘗試將 NCA 模型應用於 CFD 資料。
- **條列重點**:
  - 將 GNCA 的架構進行修改，使其適應 CFD 資料的通道結構。
  - 使用 CFD 的初始幀作為 NCA 的種子 (seed)。
  - 訓練模型，使其僅基於資料擬合（MSE Loss）來學習流場的演化規則。
- **深入細節**: 這個筆記本是基準模型 (baseline)，用於評估一個「純資料驅動」的 NCA 模型在模擬流體問題上的能力與極限。它的表現將作為後續 PI-NCA 模型改進的對照組。
- **改進建議**:
  - **效能評估**: 建立一套量化評估指標，而不僅是視覺比較，來精確評估模型預測與真實 CFD 結果的差異。
  - **架構探索**: 嘗試不同的 NCA 更新網路深度或寬度，看其對模擬複雜度的影響。

### `E4-3.0_PINN_Concept_Test.ipynb`

- **簡述**: 在正式將 PINN 整合進 NCA 之前，獨立測試物理損失函數的可行性。
- **條列重點**:
  - 使用 TensorFlow/PyTorch 的自動微分功能計算流場的偏導數（梯度）。
  - 根據 Navier-Stokes 方程式，計算物理殘差 (physical residuals)，如質量守恆（散度）和動量守恆。
  - 將物理殘差作為損失函數，測試是否能驅動一個簡單的神經網路學習到基礎的物理規則。
- **深入細節**: 這是整個研究的核心技術驗證。如果一個簡單的網路無法在物理損失的驅動下學習，那麼將其整合到更複雜的 NCA 中將會非常困難。此步驟旨在隔離變數，確保 PINN 的思路在本專案的資料和環境下是可行的。
- **改進建議**:
  - **權重分析**: 分析物理損失與資料損失之間的權重平衡對訓練結果的影響。
  - **邊界條件**: 將邊界條件作為一個獨立的損失項加入，強化模型對邊界行為的學習。

### `E4-3.1_CFD_PhysicsInformed_NCA.ipynb`

- **簡述**: **本專案的核心**。將 PINN 物理損失與 CFD-GNCA 模型結合，構成最終的物理資訊 NCA (PI-NCA)。
- **條列重點**:
  - 在 NCA 的更新規則中，同時計算 MSE 資料損失和物理殘差損失。
  - 將兩者加權後作為總損失，進行端到端的訓練。
  - 期望模型不僅能「看起來像」真實流場，其內在的每一步更新都能更好地遵守物理定律。
- **深入細節**: 這是實現 `cfd pinn embedded nca` 最終目標的筆記本。訓練出的 PI-NCA 模型，理論上應比 `E4-2.0` 的純資料驅動模型具有更好的泛化能力和物理真實性，例如在預測更長時間的流場演化時，不易出現奇怪的、違反物理的結果。
- **改進建議**:
  - **課程學習**: 採用課程學習 (Curriculum Learning) 策略，先用較大的資料損失權重讓模型收斂，再逐步增加物理損失的權重。
  - **泛化能力測試**: 在與訓練集不同邊界條件或障礙物形狀的測試集上，評估模型的泛化能力。

---

## 第二部分：備用資料集與平行研究

### `E4-4.x_UrbanTales_GrowthNCA`

- **簡述**: 由於發現原始 OpenFOAM 資料集可能存在某些問題（例如模擬時間不夠長、解析度不足等），臨時轉向公開的 UrbanTales 資料集來驗證 NCA 模型的可行性。
- **條列重點**:
  - `E4-4.0`: 對 UrbanTales 資料集進行預處理。
  - `E4-4.1` & `E4-4.2`: 在這個新的、更乾淨的資料集上重複 `E4-2.0` 的實驗，測試 GNCA 模型在不同場景下的表現。
- **深入細節**: 這個系列筆記本在研究路徑上是一個「繞道」，但它提供了一個寶貴的機會來驗證 NCA 模型本身在不同資料來源下的穩健性。如果模型在 UrbanTales 上表現良好，則證明模型本身是有效的，問題可能出在最初的 CFD 資料上。

### `E4-5.0_LBM_Simulation.ipynb`

- **簡述**: 一個平行的對照研究，使用非機器學習的傳統計算流體力學方法——格子波茲曼方法 (LBM) 來模擬流體。
- **條列重點**:
  - 從頭開始實現一個基礎的 LBM 模擬器。
  - 模擬與 OpenFOAM 案例相似的場景。
- **深入細節**: LBM 是一種介於微觀分子動力學和宏觀連續介質力學之間的方法，特別適合在 GPU 上進行大規模並行計算。此筆記本的目的可能是：
  1.  作為一個學習工具，加深對流體力學的理解。
  2.  將 LBM 的模擬結果與 NCA 的結果進行比較，從另一個角度評估 NCA 的模擬保真度。
  3.  未來甚至可能用 LBM 生成更高品質的訓練資料。
- **改進建議**:
  - **混合模型**: 探索將 LBM 的部分計算（如碰撞項）用一個小型神經網路替代，構建 LBM-NN 混合模型。
  - **GPU 加速**: 使用 Taichi 或 CUDA 等工具對 LBM 進行 GPU 加速，以模擬更大規模的場景。
