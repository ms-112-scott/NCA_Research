# 如何在專案中進行測試

為了確保專案程式碼的品質與穩定性，我們導入了測試框架 `pytest`。本文件將說明單元測試 (Unit Test) 與整合測試 (Integration Test) 的概念，並示範如何執行它們。

## 測試的種類

### 1. 單元測試 (Unit Test)

*   **目的**: 測試程式中最小的功能單元（例如一個函式或一個類別的方法），確保它在隔離的環境下能正常運作。
*   **核心思想**: 專注於單一功能，不依賴外部元件（如其他類別、資料庫或網路）。
*   **在您專案中的範例 (`tests/nca/test_model.py`)**:
    *   我建立了一個測試來驗證 `BaseTextureNCA` 模型的 `seed()` 方法。
    *   這個測試會檢查 `seed()` 產生的 PyTorch 張量 (Tensor) 是否具有我們預期的**形狀 (shape)** 與**設備 (device)**。這確保了模型初始化的第一步是正確的。

### 2. 整合測試 (Integration Test)

*   **目的**: 測試多個功能單元組合在一起時，是否能如預期般協同工作。
*   **核心思想**: 驗證模組之間的互動與資料流動是否正確。
*   **在您專案中的範例 (`tests/nca/test_trainer.py`)**:
    *   我建立了一個整合測試來模擬一個完整的**單步訓練流程**。
    *   這個測試會：
        1.  初始化 `BaseTextureNCA` 模型。
        2.  初始化一個模擬的 `MSELoss` 損失函數。
        3.  初始化 `NCATrainer`。
        4.  執行 `trainer.train_step()`。
    *   **驗證**:
        *   訓練後產生的損失 (loss) 是一個有效的數字 (不是 `NaN` 或無限大)。
        *   模型的權重 (weights) 在訓練後**有被更新**，證明反向傳播和優化器有正常運作。
        *   回傳的資料批次 (`batch_x`) 具有正確的形狀。

## 如何執行測試

### 1. 安裝測試框架

首先，請確保您已經安裝了 `pytest`。我已經將它加入 `requirements.txt`，您可以透過以下指令安裝：

```bash
pip install -r requirements.txt
```

### 2. 執行所有測試

在專案的根目錄下，直接執行以下指令：

```bash
pytest
```

`pytest` 會自動掃描專案中所有以 `test_` 開頭的 Python 檔案和函式，並執行它們。您會看到類似以下的輸出：

```
============================= test session starts ==============================
...
collected 3 items

tests/nca/test_model.py ..                                               [ 66%]
tests/nca/test_trainer.py .                                              [100%]

============================== 3 passed in ...s ===============================
```

*   `.` (點) 表示一個測試通過。
*   `F` 表示一個測試失敗 (Failed)。
*   `E` 表示一個測試發生錯誤 (Error)。

## 總結

撰寫測試是一個良好的開發習慣，它能幫助您：

*   **及早發現問題**: 在開發早期捕捉到 Bug。
*   **安心重構**: 當您需要修改或優化程式碼時，可以透過執行測試來確保沒有破壞原有的功能。
*   **程式碼文件化**: 測試案例本身就是一種說明文件，它展示了函式或類別的預期用法。

您可以參考我建立的 `tests/nca/test_model.py` 和 `tests/nca/test_trainer.py` 檔案，來為您的 LBM 模組或其他新功能撰寫新的測試。
